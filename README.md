# Keycloak BFF Auth (FastAPI)

Backend-for-Frontend (BFF) —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ FastAPI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Keycloak (OIDC).
–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π OAuth2 / OpenID Connect flow, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

    ‚Ä¢	üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Keycloak (Authorization Code Flow)
	‚Ä¢	üß† –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –Ω–∞ backend (BFF-–ø–æ–¥—Ö–æ–¥)
	‚Ä¢	üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ access / refresh —Ç–æ–∫–µ–Ω–æ–≤
	‚Ä¢	üë§ Endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
	‚Ä¢	ü§ñ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö model-—Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ –≤—Ç–æ—Ä–æ–≥–æ Keycloak-realm
	‚Ä¢	üç™ –†–∞–±–æ—Ç–∞ —Å secure HTTP-cookies
	‚Ä¢	üåç CORS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö frontend-–¥–æ–º–µ–Ω–æ–≤
	‚Ä¢	‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π FastAPI

## üîê –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

## /auth/login

–ù–∞—á–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Keycloak.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
	‚Ä¢	kc_idp_hint ‚Äî –≤—ã–±–æ—Ä identity provider (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
	‚Ä¢	force=true ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω


## /auth/callback

OIDC callback –æ—Ç Keycloak.
–°–æ–∑–¥–∞—ë—Ç backend-—Å–µ—Å—Å–∏—é –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ frontend —Å sid.


## /get_model_tokens

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç model tokens.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö / ML-–∑–∞–ø—Ä–æ—Å–æ–≤.


## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

    ‚Ä¢	–ü—Ä–æ–≤–µ—Ä–∫–∞ state –∏ nonce
	‚Ä¢	–í–∞–ª–∏–¥–∞—Ü–∏—è id_token —á–µ—Ä–µ–∑ JWKS
	‚Ä¢	HttpOnly cookies
	‚Ä¢	Secure + SameSite –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
	‚Ä¢	TTL –¥–ª—è OIDC discovery



## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

	‚Ä¢	FastAPI
	‚Ä¢	Keycloak
	‚Ä¢	OpenID Connect
	‚Ä¢	httpx / requests
	‚Ä¢	PyJWT
	‚Ä¢	itsdangerous
	‚Ä¢	Pydantic Settings

  
